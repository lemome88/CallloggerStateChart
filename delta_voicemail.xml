<?xml version="1.0" encoding="UTF-8"?>
<delta id="voicemail"> <!--Delta to add voiceMail feature -->
    <modify element="state" id="link_callee">
        <add element="transition" event="subscriber?Ack" cond="ack" target="wait">
            <add element="script">
                <set script="id=voicemail"/>
            </add>
        </add>
    </modify>
    
    <modify element="transition" id="calle?Ack"><!-- Add script to calle?Ack, this could also be out of the parent modify -->
        <add element="script">
            <set script="id=basic"/>
        </add>
    </modify>
     
    <modify element="state" id="s1">
        <add element="state" id="link_callee_voicemail">
            <add element="transition" event="participant?Ack" target="wait">
                <add element="script">
                    <set script="id=voicemail"/>
                 </add>
            </add>
            <add element="transition" event="callee?Ack" target="wait">
                <add element="script">
                    <set script="id=basic"/>
                </add>
            </add>
        </add>
    </modify>
    
    <modify element="state" id="wait">
        <add element="transition" event="participant?Unavail" cond="zone=source" target="log_failure"/>
        <add element="transition" event="subscriber?Unavail" cond="zone=target" target="log_failure"/>
        <add element="transition" event="redirectToVoiceMail" cond="zone=target" target="log_voicemail"/>
    </modify>
    
   <modify element="state" id="call_logger">
       <add element="state" id="log_voicemail" finale="true"/>
   </modify>
</delta>


